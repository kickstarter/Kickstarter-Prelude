#!/bin/sh

set -o pipefail

if [ $# -eq 0 ]; then
    echo "Please specify a target, i.e. iOS or tvOS."
  exit 1
fi

if [ "$1" == "iOS" ] || [ "$1" == "UIKit-iOS" ]; then
  DESTINATION='platform=iOS Simulator,name=iPhone 6'
else
  DESTINATION='platform=tvOS Simulator,name=Apple TV 1080p'
fi

xcodebuild \
  -destination "$DESTINATION" \
  -scheme Prelude-$1 \
  clean build test \
  | tee $CIRCLE_ARTIFACTS/xcode_raw.log \
  | xcpretty
